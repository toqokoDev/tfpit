import{_ as M}from"./DJuPW7wP.js";import{_ as S}from"./Cm8hpxjP.js";import{s as T,e as A,x as F,R as G,k as h,z as U,y as J,u as $,c as l,g as e,b as c,a as s,w as f,q as p,t as d,f as k,F as j,j as z,B as v,o as r,d as E,n as I}from"./DZ62IjT-.js";import{u as K}from"./DWzOavYo.js";import{a as O,C as P}from"./6oSe0hi4.js";import{E as Q,H as W,G as X}from"./BUPqiz4f.js";const q=T("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Y={class:"container mx-auto px-4 py-8"},Z={key:0,class:"flex items-center justify-center min-h-[60vh]"},ee={key:1,class:"flex flex-col items-center justify-center min-h-[60vh]"},te={class:"text-center"},ae={key:2,class:"max-w-4xl mx-auto"},se={class:"mb-6 flex items-center justify-between"},oe={class:"space-y-6"},re={key:0,class:"flex items-center gap-4 pb-4 border-b"},le={key:0,class:"w-12 h-12 rounded-full overflow-hidden"},ne=["src","alt"],ie={key:1,class:"w-12 h-12 rounded-full bg-muted flex items-center justify-center"},ue={class:"text-lg font-medium"},ce={class:"font-medium"},de={class:"text-3xl font-bold mb-2"},me={class:"text-muted-foreground text-lg"},_e={key:1,class:"space-y-4"},pe={class:"relative aspect-[3/4] w-full max-w-md mx-auto overflow-hidden rounded-lg bg-muted"},ge=["src","alt"],fe={key:2,class:"absolute bottom-2 left-1/2 -translate-x-1/2 rounded-full bg-background/80 backdrop-blur-sm px-3 py-1 text-xs font-medium"},he={key:3,class:"absolute bottom-2 right-2 flex gap-1"},ve={key:0,class:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-2"},be=["onClick"],ye=["src","alt"],we={class:"flex flex-wrap gap-4 text-sm text-muted-foreground pt-4 border-t"},ke={class:"flex items-center gap-2"},xe={class:"flex items-center gap-2"},Ce={class:"flex items-center gap-2"},$e={class:"text-sm text-muted-foreground"},je={key:0},Re=A({__name:"[id]",setup(ze){const B=F(),b=G(),y=K(),x=B.params.id,t=h(null),w=h(!0),i=h(0),m=h(null);async function D(){try{w.value=!0;const{data:a,error:o}=await y.from("portfolios").select(`
        id,
        image_url,
        category,
        description,
        is_public,
        likes_count,
        views_count,
        created_at,
        updated_at,
        user_id
      `).eq("id",x).eq("is_public",!0).single();if(o||!a)throw new Error("Портфолио не найдено или недоступно");if(!a.is_public)throw new Error("Портфолио недоступно");const _={id:a.id,image_url:a.image_url?a.image_url.split("|").filter(u=>u.trim()):[],category:a.category,description:a.description,is_public:a.is_public,likes_count:a.likes_count,views_count:a.views_count,created_at:a.created_at,updated_at:a.updated_at};t.value=_;const{data:n,error:g}=await y.from("users").select("first_name, last_name, avatar_url").eq("id",a.user_id).single();!g&&n&&(m.value={first_name:n.first_name||"",last_name:n.last_name||"",avatar_url:n.avatar_url}),await y.from("portfolios").update({views_count:a.views_count+1}).eq("id",x)}catch(a){v.error(a.message||"Ошибка при загрузке портфолио"),await b.push("/")}finally{w.value=!1}}function L(){t.value&&t.value.image_url&&(i.value=(i.value+1)%t.value.image_url.length)}function R(){if(t.value&&t.value.image_url){const a=t.value.image_url.length;i.value=(i.value-1+a)%a}}function C(a){return new Date(a).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"})}async function H(){const a=window.location.href;await N(a)}async function N(a){try{await navigator.clipboard.writeText(a),v.success("Ссылка скопирована в буфер обмена")}catch{const _=document.createElement("textarea");_.value=a,_.style.position="fixed",_.style.opacity="0",document.body.appendChild(_),_.select();try{document.execCommand("copy"),v.success("Ссылка скопирована в буфер обмена")}catch{v.error("Не удалось скопировать ссылку")}document.body.removeChild(_)}}return U(async()=>{await D()}),J(t,a=>{a&&$({title:`${a.category} - Портфолио`,meta:[{name:"description",content:a.description||"Просмотр портфолио"}]})},{immediate:!0}),$({title:"Портфолио",meta:[{name:"description",content:"Просмотр портфолио"}]}),(a,o)=>{const _=M,n=S;return r(),l("div",Y,[e(w)?(r(),l("div",Z,[c(_,{size:"lg"})])):e(t)?(r(),l("div",ae,[s("div",se,[c(n,{variant:"ghost",onClick:o[1]||(o[1]=g=>e(b).back())},{default:f(()=>[c(e(q),{class:"w-4 h-4 mr-2"}),o[4]||(o[4]=E(" Назад ",-1))]),_:1}),c(n,{onClick:H,size:"icon"},{default:f(()=>[...o[5]||(o[5]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})],-1)])]),_:1})]),s("div",oe,[e(m)?(r(),l("div",re,[e(m).avatar_url?(r(),l("div",le,[s("img",{src:e(m).avatar_url,alt:`${e(m).first_name} ${e(m).last_name}`,class:"w-full h-full object-cover"},null,8,ne)])):(r(),l("div",ie,[s("span",ue,d((e(m).first_name?.[0]||"")+(e(m).last_name?.[0]||"")),1)])),s("div",null,[s("p",ce,d(e(m).first_name)+" "+d(e(m).last_name),1),o[6]||(o[6]=s("p",{class:"text-sm text-muted-foreground"},"Автор портфолио",-1))])])):p("",!0),s("div",null,[s("h1",de,d(e(t).category),1),s("p",me,d(e(t).description),1)]),e(t).image_url&&e(t).image_url.length>0?(r(),l("div",_e,[s("div",pe,[s("img",{src:e(t).image_url[e(i)],alt:`${e(t).category} - ${e(i)+1}`,class:"h-full w-full object-cover transition-opacity duration-300",loading:"lazy"},null,8,ge),e(t).image_url.length>1?(r(),k(n,{key:0,onClick:R,type:"button",class:"absolute left-2 top-1/2 -translate-y-1/2 rounded-full bg-background/80 backdrop-blur-sm p-2 text-foreground shadow-lg transition-all hover:bg-background/90 disabled:opacity-50",disabled:e(t).image_url.length<=1},{default:f(()=>[c(e(O),{class:"h-5 w-5"})]),_:1},8,["disabled"])):p("",!0),e(t).image_url.length>1?(r(),k(n,{key:1,onClick:L,type:"button",class:"absolute right-2 top-1/2 -translate-y-1/2 rounded-full bg-background/80 backdrop-blur-sm p-2 text-foreground shadow-lg transition-all hover:bg-background/90 disabled:opacity-50",disabled:e(t).image_url.length<=1},{default:f(()=>[c(e(P),{class:"h-5 w-5"})]),_:1},8,["disabled"])):p("",!0),e(t).image_url.length>1?(r(),l("div",fe,d(e(i)+1)+" / "+d(e(t).image_url.length),1)):p("",!0),e(t).image_url.length>1?(r(),l("div",he,[(r(!0),l(j,null,z(e(t).image_url,(g,u)=>(r(),k(n,{key:u,onClick:V=>i.value=u,type:"button",class:I(["h-2 w-2 rounded-full transition-all",u===e(i)?"bg-primary w-6":"bg-background/60 hover:bg-background/80"]),"aria-label":`Перейти к изображению ${u+1}`},null,8,["onClick","class","aria-label"]))),128))])):p("",!0)]),e(t).image_url.length>1?(r(),l("div",ve,[(r(!0),l(j,null,z(e(t).image_url,(g,u)=>(r(),l("button",{key:u,onClick:V=>i.value=u,type:"button",class:I(["relative aspect-square overflow-hidden rounded-lg border-2 transition-all",u===e(i)?"border-primary":"border-transparent hover:border-primary/50"])},[s("img",{src:g,alt:`Миниатюра ${u+1}`,class:"h-full w-full object-cover"},null,8,ye)],10,be))),128))])):p("",!0)])):p("",!0),s("div",we,[s("div",ke,[c(e(Q),{class:"w-4 h-4"}),s("span",null,d(e(t).views_count)+" просмотров",1)]),s("div",xe,[c(e(W),{class:"w-4 h-4"}),s("span",null,d(e(t).likes_count)+" лайков",1)]),s("div",Ce,[c(e(X),{class:"w-4 h-4"}),o[7]||(o[7]=s("span",null,"Публичное",-1))])]),s("div",$e,[s("p",null,"Создано: "+d(C(e(t).created_at)),1),e(t).updated_at!==e(t).created_at?(r(),l("p",je," Обновлено: "+d(C(e(t).updated_at)),1)):p("",!0)])])])):(r(),l("div",ee,[s("div",te,[o[3]||(o[3]=s("p",{class:"text-muted-foreground mb-4 text-lg"},"Портфолио не найдено или недоступно",-1)),c(n,{onClick:o[0]||(o[0]=g=>e(b).push("/"))},{default:f(()=>[c(e(q),{class:"w-4 h-4 mr-2"}),o[2]||(o[2]=E(" Вернуться на главную ",-1))]),_:1})])]))])}}});export{Re as default};
