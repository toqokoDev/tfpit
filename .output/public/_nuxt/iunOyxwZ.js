import{_ as L}from"./Nyoiwj8l.js";import{_ as O}from"./DJuPW7wP.js";import{_ as P}from"./CjtgTk1I.js";import{_ as U}from"./Cu0S5-rx.js";import{u as W,_ as A,t as D,a as H,b as I}from"./C5YCDKKw.js";import{_ as K,a as G,b as J,c as Q,d as X,e as Y}from"./CR-AhlAP.js";import{_ as Z}from"./Cm8hpxjP.js";import{_ as ee}from"./yIqUKY2c.js";import{s as te,e as oe,k as l,A as ne,z as se,B as b,u as ae,c as d,a as n,b as t,g as a,w as s,p as le,o as f,d as r}from"./DZ62IjT-.js";import{u as re}from"./DWzOavYo.js";import{r as _e}from"./DL3Q6CDs.js";import"./CnvqL-Ka.js";import"./qjfj-mJN.js";import"./CMpkczBb.js";const ie=te("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]),me={class:"bg-muted flex min-h-svh flex-col items-center justify-center gap-6 p-6 md:p-10"},ce={class:"flex w-full max-w-sm flex-col gap-6"},pe={class:"flex items-center gap-2 self-center font-medium"},ue={class:"flex flex-1 items-center justify-center"},de={key:0,class:"flex justify-center"},fe={class:"grid grid-cols-2 gap-2"},xe={class:"text-center text-sm"},ge={class:"flex flex-col items-center justify-center py-4"},ye={class:"bg-primary/10 p-3 rounded-full mb-4"},Ne=oe({__name:"register",setup(be){const x=re(),i=l([]),m=l(!0),c=l(!1),p=l(!1),g=l(null),h=ne(()=>i.value.map(o=>({label:o.title,value:o.id}))),{handleSubmit:w}=W({validationSchema:D(_e),initialValues:{role:"",first_name:"",last_name:"",email:"",password:""}});se(()=>{v()});const y=w(async o=>{try{g.value=null,c.value=!0;const{error:e}=await x.auth.signUp({email:o.email,password:o.password,options:{emailRedirectTo:`${window.location.origin}/auth/confirm`,data:{first_name:o.first_name,last_name:o.last_name,role:o.role}}});if(e)throw e;p.value=!0}catch(e){g.value=e.message||"errors.somethingWentWrong",b.error("Ошибка при регистрации")}finally{c.value=!1}});async function v(){try{m.value=!0;const{data:o,error:e}=await x.from("roles").select("*");if(e)throw e;i.value=o,console.log(i)}catch(o){console.error(o),b.error("Не удалось загрузить роли")}finally{m.value=!1}}return ae({title:"Регистрация"}),(o,e)=>{const k=L,S=O,_=P,C=U,j=I,B=H,T=le("router-link"),V=A,$=Q,E=X,F=J,M=Z,N=ee,R=Y,q=G,z=K;return f(),d("div",me,[n("div",ce,[n("span",pe,[t(k)]),n("div",ue,[a(m)?(f(),d("div",de,[t(S)])):(f(),d("form",{key:1,class:"flex flex-col gap-6 w-full max-w-xs",onSubmit:e[0]||(e[0]=(...u)=>a(y)&&a(y)(...u))},[t(V,null,{default:s(()=>[e[4]||(e[4]=n("div",{class:"flex flex-col items-center gap-1 text-center"},[n("h1",{class:"text-2xl font-bold"},"Создать аккаунт"),n("p",{class:"text-muted-foreground text-sm text-balance"}," Заполните данные для регистрации в TFP сообществе ")],-1)),n("div",fe,[t(_,{name:"first_name",type:"text",label:"Имя",placeholder:"Иван"}),t(_,{name:"last_name",type:"text",label:"Фамилия",placeholder:"Иванов"})]),t(C,{name:"role",label:"Выберите роль",placeholder:"Кто вы?",options:a(h)},null,8,["options"]),t(_,{name:"email",type:"email",label:"Email",placeholder:"email@example.com",autocomplete:"email"}),t(_,{name:"password",type:"password",label:"Пароль",placeholder:"********",autocomplete:"new-password"}),t(B,null,{default:s(()=>[t(j,{type:"submit",label:"Создать аккаунт","is-processing":a(c)},null,8,["is-processing"])]),_:1}),n("div",xe,[e[3]||(e[3]=r(" Уже есть аккаунта? ",-1)),t(T,{to:"/auth/login",class:"underline underline-offset-4 hover:text-primary"},{default:s(()=>[...e[2]||(e[2]=[r(" Войти ",-1)])]),_:1})])]),_:1})],32))])]),t(z,{open:a(p),"onUpdate:open":e[1]||(e[1]=u=>p.value=u)},{default:s(()=>[t(q,{class:"sm:max-w-md"},{default:s(()=>[t(F,null,{default:s(()=>[t($,null,{default:s(()=>[...e[5]||(e[5]=[r("Проверьте почту",-1)])]),_:1}),t(E,null,{default:s(()=>[...e[6]||(e[6]=[r(" Мы отправили письмо со ссылкой для подтверждения на ваш адрес. ",-1)])]),_:1})]),_:1}),n("div",ge,[n("div",ye,[t(a(ie),{class:"h-10 w-10 text-primary"})]),e[7]||(e[7]=n("p",{class:"text-sm text-center text-muted-foreground"}," Пожалуйста, перейдите по ссылке в письме, чтобы завершить регистрацию и войти в аккаунт. ",-1))]),t(R,null,{default:s(()=>[t(N,{to:"/","as-child":""},{default:s(()=>[t(M,{type:"button",variant:"secondary"},{default:s(()=>[...e[8]||(e[8]=[r(" Хорошо ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])])}}});export{Ne as default};
